# 项目状态快照

## 当前结论（必须最新）
- 现状：主脚本采用全站 `@match` + 启动后域名门禁；用户侧存在“脚本亮起但无可见效果”排查困难问题。
- 已完成：重建 `AGENTS.md`；新增 `PLANS.md` 并明确本轮执行计划。
- 正在做：将域名 seeds 内置到脚本，并补齐后端失败可视化提示。
- 下一步：完成脚本改造、更新变更日志、提交不含 `src/packages/obr-theatre-battle-system-com.json` 的代码。

## 关键决策与理由（防止“吃书”）
- 决策A：保留“全站触发 + 门禁快速退出”总体架构（原因：兼顾兼容性与性能，不干扰非目标站点）。
- 决策B：把 seeds 内置到用户脚本，仅作为首层快速放行（原因：首次不依赖网络即可判定是否继续，提升冷启动稳定性）。
- 决策C：远端 allowlist 继续作为准入真值源（原因：后端可动态维护域名规则，避免每次改域名都强制用户更新脚本）。
- 决策D：为“后端不可达”增加可视化提示（原因：降低用户误判成本，便于远程协助定位网络可达性问题）。

## 常见坑 / 复现方法
- 坑1：油猴脚本显示“启用/亮起”不等于翻译流程已生效；脚本可能在域名门禁阶段提前退出。
- 坑2：首次访问目标站点时若后端不可达且本地无缓存，会出现“无悬浮球、无翻译”的静默失败体验。
