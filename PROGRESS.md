# 项目状态快照

## 当前结论（必须最新）
- 现状：已修复“iframe 插件页不再翻译”的回归问题，主脚本 seeds 门禁现已覆盖已接入插件域名。
- 已完成：自定义域部署（`overlaylex-api.zjhstudio.com`）；主脚本 seeds 内置与失败提示；本次已将 `LOCAL_DOMAIN_SEEDS` 扩展并把脚本版本升级到 `0.2.14`。
- 正在做：等待用户侧在 OBR 房间 + iframe 插件场景复测。
- 下一步：如仍有漏网域名，补充到 seeds/allowlist 并滚动发版。

## 关键决策与理由（防止“吃书”）
- 决策A：保留“全站触发 + 门禁快速退出”总体架构（原因：兼顾兼容性与性能，不干扰非目标站点）。
- 决策B：把 seeds 内置到用户脚本，仅作为首层快速放行（原因：首次不依赖网络即可判定是否继续，提升冷启动稳定性）。
- 决策C：远端 allowlist 继续作为准入真值源（原因：后端可动态维护域名规则，避免每次改域名都强制用户更新脚本）。
- 决策D：为“后端不可达”增加可视化提示（原因：降低用户误判成本，便于远程协助定位网络可达性问题）。
- 决策E：默认 API 改用自定义域（原因：部分地区/网络对 `workers.dev` 可达性较差，自有域通常更稳定且可控）。
- 决策F：本地 seeds 必须覆盖“已知插件域名集合”（原因：seeds 位于启动最前置门禁，过窄会直接导致 iframe 页面无法进入翻译链路）。

## 常见坑 / 复现方法
- 坑1：油猴脚本显示“启用/亮起”不等于翻译流程已生效；脚本可能在域名门禁阶段提前退出。
- 坑2：首次访问目标站点时若后端不可达且本地无缓存，会出现“无悬浮球、无翻译”的静默失败体验。
- 坑3：若页面仅命中全站 `@match` 但未命中本地 seeds，脚本会快速退出；这是预期行为，不是注入异常。
- 坑4：仅用命令行临时加域名而不写入 `wrangler.toml`，后续部署可能出现“配置漂移”；需把域名路由固化到配置文件。
- 坑5：本地 seeds 与 `overlaylex-domain-allowlist` 不一致时，可能出现“远端已放行但本地提前拦截”的假阴性问题。
